<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Market Trend Analyzer ğŸ“ˆ</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg: #0a0a0f; --bg2: #0f0f1a; --card: #111120;
  --border: #1e1e2e; --text: #e8e4dc; --muted: #555;
  --green: #00e5a0; --yellow: #f5c542; --red: #ff5e5e; --blue: #4f9eff;
}
body { background: var(--bg); color: var(--text); font-family: 'Syne', sans-serif; min-height: 100vh; }

/* Layout */
.app { display: grid; grid-template-columns: 240px 1fr; min-height: 100vh; }
.sidebar { background: var(--bg2); border-right: 1px solid var(--border); padding: 2rem 1.5rem; position: sticky; top: 0; height: 100vh; overflow-y: auto; }
.main { padding: 2rem 2.5rem; }

/* Sidebar */
.sidebar-logo { font-size: 1.5rem; font-weight: 800; margin-bottom: 0.25rem; }
.sidebar-sub  { font-size: 0.75rem; color: var(--muted); font-family: 'IBM Plex Mono', monospace; margin-bottom: 1.5rem; }
.sidebar hr   { border: none; border-top: 1px solid var(--border); margin: 1rem 0; }
.sidebar ol   { padding-left: 1.2rem; color: #aaa; font-size: 0.82rem; line-height: 2.2; }
.sidebar-note { font-size: 0.72rem; color: #444; font-family: 'IBM Plex Mono', monospace; margin-top: 1rem; }

/* Header */
h1 { font-size: 2rem; font-weight: 800; }
h2 { font-size: 1.3rem; font-weight: 800; margin-bottom: 0.5rem; }
h3 { font-size: 1rem; font-weight: 700; margin-bottom: 0.75rem; }
.subtitle { color: var(--muted); font-size: 0.88rem; margin-bottom: 1.5rem; }
hr { border: none; border-top: 1px solid var(--border); margin: 1.5rem 0; }

/* Upload */
.upload-zone {
  background: #001a12; border: 1.5px dashed #00e5a030; border-radius: 12px;
  padding: 2.5rem; text-align: center; cursor: pointer; transition: border-color 0.2s;
  position: relative; margin-bottom: 1rem;
}
.upload-zone:hover { border-color: #00e5a080; }
.upload-zone input { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%; }
.upload-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
.upload-text { font-size: 0.85rem; color: var(--muted); font-family: 'IBM Plex Mono', monospace; }
.upload-name { color: var(--green); font-size: 0.82rem; margin-top: 0.4rem; font-family: 'IBM Plex Mono', monospace; }

/* Button */
.btn { background: var(--green); color: var(--bg); border: none; border-radius: 8px; font-family: 'Syne', sans-serif; font-weight: 700; font-size: 1rem; padding: 0.75rem 2rem; cursor: pointer; width: 100%; transition: opacity 0.2s; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
.btn:hover { opacity: 0.85; }
.btn:disabled { opacity: 0.45; cursor: not-allowed; }

/* Spinner */
.spin { display: inline-block; width: 16px; height: 16px; border: 2px solid var(--bg); border-top-color: transparent; border-radius: 50%; animation: rot 0.7s linear infinite; }
@keyframes rot { to { transform: rotate(360deg); } }

/* Status */
.status { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 0.75rem 1rem; font-size: 0.82rem; color: #aaa; font-family: 'IBM Plex Mono', monospace; display: none; margin-top: 0.75rem; }
.status.show { display: block; }

/* Error */
.error-box { background: #ff5e5e15; border: 1px solid #ff5e5e40; color: var(--red); border-radius: 8px; padding: 0.75rem 1rem; font-size: 0.85rem; display: none; margin-top: 0.75rem; }
.error-box.show { display: block; }

/* Metrics grid */
.metrics-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
.metric-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; text-align: center; }
.metric-val { font-size: 2.4rem; font-weight: 800; font-family: 'IBM Plex Mono', monospace; line-height: 1; }
.metric-lbl { font-size: 0.7rem; letter-spacing: 0.18em; text-transform: uppercase; color: var(--muted); margin-top: 0.5rem; }
.c-green { color: var(--green); } .c-yellow { color: var(--yellow); } .c-red { color: var(--red); } .c-blue { color: var(--blue); }

/* Section card */
.section { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; }
.insight-card { background: var(--card); border-left: 3px solid var(--green); border-radius: 0 12px 12px 0; padding: 1rem 1.25rem; margin-bottom: 1.5rem; }
.insight-label { font-size: 0.68rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); margin-bottom: 0.5rem; font-family: 'IBM Plex Mono', monospace; }
.insight-text  { font-size: 0.95rem; line-height: 1.7; color: var(--text); }

/* Chart container */
.chart-wrap { position: relative; height: 300px; margin-bottom: 1rem; }

/* Pills */
.pill-row { display: flex; flex-wrap: wrap; gap: 0.4rem; margin-top: 0.5rem; }
.pill { font-family: 'IBM Plex Mono', monospace; font-size: 0.72rem; padding: 0.2rem 0.65rem; border-radius: 999px; font-weight: 500; border: 1px solid; }
.pill-green  { background: #00e5a015; border-color: #00e5a040; color: var(--green); }
.pill-red    { background: #ff5e5e15; border-color: #ff5e5e40; color: var(--red); }
.pill-blue   { background: #4f9eff15; border-color: #4f9eff40; color: var(--blue); }
.pill-yellow { background: #f5c54215; border-color: #f5c54240; color: var(--yellow); }

/* Pill columns */
.pill-cols { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1rem; }
.pill-col-title { font-size: 0.78rem; font-weight: 700; margin-bottom: 0.5rem; }

/* Skill insights list */
.skill-row { background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 0.75rem 1rem; margin-bottom: 0.5rem; display: flex; gap: 1rem; align-items: center; }
.skill-name  { font-family: 'IBM Plex Mono', monospace; font-size: 0.78rem; color: var(--green); min-width: 120px; }
.skill-trend { font-size: 0.75rem; color: var(--muted); min-width: 80px; }
.skill-comment { font-size: 0.78rem; color: #888; }

/* Job cards */
.job-card { background: var(--bg); border: 1px solid var(--border); border-radius: 10px; padding: 1.25rem; margin-bottom: 0.75rem; }
.job-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
.job-title  { font-weight: 700; font-size: 0.95rem; }
.job-match  { font-family: 'IBM Plex Mono', monospace; font-size: 1.1rem; font-weight: 800; }
.job-salary { font-size: 0.75rem; color: var(--muted); margin-bottom: 0.5rem; }
.job-section-label { font-size: 0.68rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.12em; margin-bottom: 0.3rem; font-family: 'IBM Plex Mono', monospace; }

/* Salary table */
.sal-table { width: 100%; border-collapse: collapse; font-size: 0.82rem; }
.sal-table th { text-align: left; color: var(--muted); font-size: 0.68rem; letter-spacing: 0.12em; text-transform: uppercase; padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--border); font-family: 'IBM Plex Mono', monospace; font-weight: 500; }
.sal-table td { padding: 0.6rem 0.75rem; border-bottom: 1px solid #1e1e2e50; }
.sal-table tr:last-child td { border-bottom: none; }
.sal-table tr:hover td { background: #ffffff05; }

/* Salary metrics */
.sal-metrics { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.25rem; }

/* Learning path */
.learn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
.learn-card { background: var(--bg); border: 1px solid var(--border); border-radius: 10px; padding: 1.1rem; }
.learn-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem; }
.learn-skill { font-family: 'IBM Plex Mono', monospace; font-size: 0.82rem; font-weight: 700; }
.learn-badge { font-size: 0.62rem; padding: 0.12rem 0.5rem; border-radius: 999px; font-family: 'IBM Plex Mono', monospace; border: 1px solid; }
.learn-resource { font-size: 0.82rem; color: #c8c4bc; margin-bottom: 0.5rem; }
.learn-meta { display: flex; gap: 1rem; font-size: 0.75rem; color: var(--muted); }
.learn-salary { color: var(--green) !important; }

/* Gap rows */
.gap-row { background: var(--bg); border: 1px solid #ff5e5e20; border-radius: 8px; padding: 0.75rem 1rem; margin-bottom: 0.5rem; display: flex; gap: 1rem; align-items: center; }
.gap-skill { font-family: 'IBM Plex Mono', monospace; font-size: 0.78rem; color: var(--red); min-width: 150px; }
.gap-why   { font-size: 0.78rem; color: #888; }

/* Results hidden initially */
#results { display: none; }

/* Responsive */
@media (max-width: 900px) {
  .app { grid-template-columns: 1fr; }
  .sidebar { display: none; }
  .metrics-grid { grid-template-columns: 1fr 1fr; }
  .pill-cols, .learn-grid { grid-template-columns: 1fr; }
  .sal-metrics { grid-template-columns: 1fr; }
}
</style>
</head>
<body>
<div class="app">

<!-- Sidebar -->
<aside class="sidebar">
  <div class="sidebar-logo">ğŸ“ˆ Market AI</div>
  <div class="sidebar-sub">Trend Analyzer</div>
  <hr/>
  <p style="font-size:0.82rem;font-weight:700;margin-bottom:0.5rem">Powered by Gemini AI</p>
  <ol>
    <li>Upload your resume PDF</li>
    <li>Hit Analyze Market</li>
    <li>Get real-time insights:</li>
  </ol>
  <ul style="padding-left:1.2rem;color:#aaa;font-size:0.78rem;line-height:2.1;margin-top:0.5rem">
    <li>Skill demand scores</li>
    <li>Market trend charts</li>
    <li>Job role matches</li>
    <li>Salary insights</li>
    <li>Skill gap report</li>
    <li>Learning path</li>
  </ul>
  <div class="sidebar-note">No dataset needed â€”<br/>Gemini knows the market</div>
</aside>

<!-- Main -->
<main class="main">
  <h1>ğŸ“ˆ Market Trend Analyzer</h1>
  <p class="subtitle">AI-powered job market analysis â€” upload your resume and get instant insights</p>
  <hr/>

  <!-- Upload -->
  <h3>ğŸ“„ Upload Your Resume</h3>
  <div class="upload-zone" id="dropZone">
    <input type="file" id="resumeFile" accept=".pdf" onchange="onFileChange(this)"/>
    <div class="upload-icon">ğŸ“„</div>
    <div class="upload-text">Drop PDF here or click to browse</div>
    <div class="upload-name" id="fileName"></div>
  </div>
  <button class="btn" id="analyzeBtn" onclick="runAnalysis()">ğŸ” &nbsp;Analyze Market</button>
  <div class="status" id="status">â³ Initializing...</div>
  <div class="error-box" id="errBox"></div>

  <!-- Results -->
  <div id="results">
    <hr/>
    <h2>ğŸ“Š Market Analysis Results</h2>

    <!-- Summary -->
    <div class="insight-card" id="summaryCard">
      <div class="insight-label">AI Market Assessment</div>
      <div class="insight-text" id="summaryText"></div>
    </div>

    <!-- Metrics -->
    <div class="metrics-grid">
      <div class="metric-card"><div class="metric-val c-green" id="mSkills">â€”</div><div class="metric-lbl">Skills Detected</div></div>
      <div class="metric-card"><div class="metric-val" id="mHighDemand">â€”</div><div class="metric-lbl">High Demand Skills</div></div>
      <div class="metric-card"><div class="metric-val" id="mMatch">â€”</div><div class="metric-lbl">Avg Job Match</div></div>
      <div class="metric-card"><div class="metric-val" id="mGaps">â€”</div><div class="metric-lbl">Skill Gaps Found</div></div>
    </div>

    <!-- 1. Skill Demand Chart -->
    <div class="section">
      <h3>ğŸ” Your Skills vs Market Demand</h3>
      <div class="chart-wrap"><canvas id="skillDemandChart"></canvas></div>
      <div class="pill-cols" id="demandPills"></div>
      <div id="skillInsights" style="margin-top:1rem"></div>
    </div>

    <!-- 2. Trending Skills Chart -->
    <div class="section">
      <h3>ğŸ“ˆ Top Trending Skills in 2024â€“2025 Market</h3>
      <div class="chart-wrap"><canvas id="trendingChart"></canvas></div>
    </div>

    <!-- 3. Skill Gaps Chart -->
    <div class="section">
      <h3>âŒ Critical Skill Gaps</h3>
      <div class="chart-wrap"><canvas id="gapChart"></canvas></div>
      <div id="gapList" style="margin-top:1rem"></div>
    </div>

    <!-- 4. Job Matches Chart -->
    <div class="section">
      <h3>ğŸ’¼ Best Matching Job Roles</h3>
      <div class="chart-wrap"><canvas id="jobChart"></canvas></div>
      <div id="jobCards" style="margin-top:1.25rem"></div>
    </div>

    <!-- 5. Salary Insights -->
    <div class="section">
      <h3>ğŸ’° Salary Insights</h3>
      <div id="salSummary" style="background:#f5c54215;border:1px solid #f5c54240;border-radius:8px;padding:0.75rem 1rem;font-size:0.85rem;color:#f5c542;margin-bottom:1.25rem"></div>
      <div class="sal-metrics">
        <div class="metric-card"><div class="metric-val c-yellow" id="salCurrent">â€”</div><div class="metric-lbl">Current Estimated Range</div></div>
        <div class="metric-card"><div class="metric-val c-green" id="salPotential">â€”</div><div class="metric-lbl">Potential After Upskilling</div></div>
      </div>
      <div class="chart-wrap" style="height:260px"><canvas id="salaryChart"></canvas></div>
      <table class="sal-table" id="salTable">
        <thead><tr><th>Role</th><th>Min</th><th>Avg</th><th>Max</th></tr></thead>
        <tbody id="salBody"></tbody>
      </table>
    </div>

    <!-- 6. Learning Path -->
    <div class="section">
      <h3>ğŸ¯ Prioritized Learning Path</h3>
      <p style="color:var(--muted);font-size:0.82rem;margin-bottom:1rem">Skills to learn for maximum career impact</p>
      <div class="learn-grid" id="learnGrid"></div>
    </div>

    <!-- Raw JSON -->
    <details style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:1rem 1.25rem;margin-top:1rem">
      <summary style="font-size:0.85rem;font-weight:600;cursor:pointer">ğŸ”© Raw JSON</summary>
      <pre id="rawJson" style="margin-top:0.75rem;font-size:0.7rem;color:#888;overflow:auto;max-height:400px"></pre>
    </details>
  </div>
</main>
</div>

<script>
const API = 'http://localhost:8000';
let charts = {};

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function onFileChange(input) {
  document.getElementById('fileName').textContent = input.files[0]?.name ? `ğŸ“ ${input.files[0].name}` : '';
}

function setStatus(msg) {
  const el = document.getElementById('status');
  el.textContent = msg;
  el.classList.add('show');
}

function showErr(msg) {
  const el = document.getElementById('errBox');
  el.textContent = 'âŒ ' + msg;
  el.classList.add('show');
  document.getElementById('status').classList.remove('show');
}

function scoreColor(v) { return v >= 75 ? '#00e5a0' : v >= 50 ? '#f5c542' : '#ff5e5e'; }
function scoreClass(v) { return v >= 75 ? 'c-green' : v >= 50 ? 'c-yellow' : 'c-red'; }

function destroyChart(id) { if (charts[id]) { charts[id].destroy(); delete charts[id]; } }

const CHART_DEFAULTS = {
  responsive: true, maintainAspectRatio: false,
  plugins: { legend: { display: false } },
  scales: {
    x: { ticks: { color: '#888', font: { family: 'IBM Plex Mono', size: 11 } }, grid: { color: '#1e1e2e' } },
    y: { ticks: { color: '#888', font: { family: 'IBM Plex Mono', size: 11 } }, grid: { color: '#1e1e2e' } }
  }
};

// â”€â”€ Main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function runAnalysis() {
  const file = document.getElementById('resumeFile').files[0];
  if (!file) { showErr('Please upload a resume PDF.'); return; }

  const btn = document.getElementById('analyzeBtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spin"></span> &nbsp;Analyzing...';
  document.getElementById('errBox').classList.remove('show');
  document.getElementById('results').style.display = 'none';
  setStatus('ğŸ“„ Reading your resume...');

  const form = new FormData();
  form.append('resume', file);

  try {
    setStatus('ğŸ§  Gemini is analyzing the job market for your skills... (this may take 15-30s)');
    const res  = await fetch(`${API}/analyze`, { method: 'POST', body: form });
    const data = await res.json();
    if (!res.ok) throw new Error(data.detail || 'Analysis failed.');

    document.getElementById('status').classList.remove('show');
    renderResults(data);
    document.getElementById('results').style.display = 'block';
    document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
  } catch (e) {
    showErr(e.message);
  } finally {
    btn.disabled = false;
    btn.innerHTML = 'ğŸ” &nbsp;Analyze Market';
  }
}

// â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderResults(data) {
  const skillDemand  = data.skill_demand   || [];
  const trending     = data.trending_skills || [];
  const gaps         = data.skill_gaps      || [];
  const jobs         = data.job_matches     || [];
  const salary       = data.salary_insights || {};
  const learning     = data.learning_path   || [];
  const skills       = data.skills          || [];

  // Summary
  document.getElementById('summaryText').textContent = data.market_summary || '';

  // Metrics
  const highDemand = skillDemand.filter(s => s.level === 'high').length;
  const avgMatch   = jobs.length ? Math.round(jobs.reduce((a, j) => a + (j.match_pct || 0), 0) / jobs.length) : 0;
  document.getElementById('mSkills').textContent    = skills.length;
  document.getElementById('mHighDemand').textContent = highDemand;
  document.getElementById('mHighDemand').className  = 'metric-val ' + scoreClass(highDemand * 10);
  document.getElementById('mMatch').textContent     = avgMatch + '%';
  document.getElementById('mMatch').className       = 'metric-val ' + scoreClass(avgMatch);
  document.getElementById('mGaps').textContent      = gaps.length;
  document.getElementById('mGaps').className        = 'metric-val ' + (gaps.length > 5 ? 'c-red' : 'c-yellow');

  // 1. Skill Demand Chart
  renderSkillDemand(skillDemand);

  // 2. Trending Chart
  renderTrending(trending);

  // 3. Gaps Chart
  renderGaps(gaps);

  // 4. Jobs Chart
  renderJobs(jobs);

  // 5. Salary
  renderSalary(salary, jobs);

  // 6. Learning Path
  renderLearning(learning);

  // Raw JSON
  document.getElementById('rawJson').textContent = JSON.stringify(data, null, 2);
}

// â”€ 1. Skill Demand â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSkillDemand(skillDemand) {
  const sorted = [...skillDemand].sort((a, b) => b.demand_score - a.demand_score);

  destroyChart('skillDemandChart');
  const ctx = document.getElementById('skillDemandChart').getContext('2d');
  charts['skillDemandChart'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: sorted.map(s => s.skill),
      datasets: [{
        data: sorted.map(s => s.demand_score),
        backgroundColor: sorted.map(s => {
          if (s.level === 'high')   return '#00e5a0cc';
          if (s.level === 'medium') return '#f5c542cc';
          return '#ff5e5ecc';
        }),
        borderRadius: 6,
      }]
    },
    options: {
      ...CHART_DEFAULTS,
      plugins: {
        ...CHART_DEFAULTS.plugins,
        tooltip: { callbacks: { label: ctx => `Demand: ${ctx.raw}/100` } }
      },
      scales: { ...CHART_DEFAULTS.scales, y: { ...CHART_DEFAULTS.scales.y, max: 100 } }
    }
  });

  // Pill cols
  document.getElementById('demandPills').innerHTML = `
    <div>
      <div class="pill-col-title" style="color:var(--green)">ğŸ”¥ High Demand</div>
      <div class="pill-row">${skillDemand.filter(s=>s.level==='high').map(s=>`<span class="pill pill-green">${s.skill}</span>`).join('') || '<span style="color:#444">None</span>'}</div>
    </div>
    <div>
      <div class="pill-col-title" style="color:var(--yellow)">âš¡ Medium Demand</div>
      <div class="pill-row">${skillDemand.filter(s=>s.level==='medium').map(s=>`<span class="pill pill-yellow">${s.skill}</span>`).join('') || '<span style="color:#444">None</span>'}</div>
    </div>
    <div>
      <div class="pill-col-title" style="color:var(--red)">â„ï¸ Low Demand</div>
      <div class="pill-row">${skillDemand.filter(s=>s.level==='low').map(s=>`<span class="pill pill-red">${s.skill}</span>`).join('') || '<span style="color:#444">None</span>'}</div>
    </div>`;

  // Insights
  const icons = { rising: 'ğŸ“ˆ', declining: 'ğŸ“‰', stable: 'â¡ï¸' };
  document.getElementById('skillInsights').innerHTML =
    '<div style="font-size:0.78rem;font-weight:700;margin-bottom:0.5rem">ğŸ’¬ Skill Insights</div>' +
    sorted.slice(0, 6).map(s => `
      <div class="skill-row">
        <span class="skill-name">${s.skill}</span>
        <span class="skill-trend">${icons[s.trend]||'â¡ï¸'} ${(s.trend||'').charAt(0).toUpperCase()+s.trend.slice(1)}</span>
        <span class="skill-comment">${s.market_comment || ''}</span>
      </div>`).join('');
}

// â”€ 2. Trending â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTrending(trending) {
  const sorted = [...trending].sort((a, b) => b.demand_score - a.demand_score);
  destroyChart('trendingChart');
  const ctx = document.getElementById('trendingChart').getContext('2d');
  charts['trendingChart'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: sorted.map(s => s.skill),
      datasets: [{
        data: sorted.map(s => s.demand_score),
        backgroundColor: sorted.map((_, i) => `hsla(${160 - i*10}, 80%, ${50 + i*2}%, 0.8)`),
        borderRadius: 6,
      }]
    },
    options: {
      ...CHART_DEFAULTS,
      indexAxis: 'y',
      scales: {
        x: { ...CHART_DEFAULTS.scales.x, max: 100 },
        y: { ...CHART_DEFAULTS.scales.y }
      }
    }
  });
}

// â”€ 3. Gaps â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderGaps(gaps) {
  const sorted = [...gaps].sort((a, b) => b.demand_score - a.demand_score);
  destroyChart('gapChart');
  const ctx = document.getElementById('gapChart').getContext('2d');
  charts['gapChart'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: sorted.map(s => s.skill),
      datasets: [{
        data: sorted.map(s => s.demand_score),
        backgroundColor: '#ff5e5ecc',
        borderRadius: 6,
      }]
    },
    options: {
      ...CHART_DEFAULTS,
      scales: { ...CHART_DEFAULTS.scales, y: { ...CHART_DEFAULTS.scales.y, max: 100 } }
    }
  });

  document.getElementById('gapList').innerHTML = sorted.map(g => `
    <div class="gap-row">
      <span class="gap-skill">${g.skill}</span>
      <span class="gap-why">${g.why_needed || ''}</span>
    </div>`).join('') || '<div style="color:var(--green)">ğŸ‰ No critical skill gaps found!</div>';
}

// â”€ 4. Jobs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderJobs(jobs) {
  const sorted = [...jobs].sort((a, b) => b.match_pct - a.match_pct).slice(0, 8);
  destroyChart('jobChart');
  const ctx = document.getElementById('jobChart').getContext('2d');
  charts['jobChart'] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: sorted.map(j => j.title),
      datasets: [{
        data: sorted.map(j => j.match_pct),
        backgroundColor: sorted.map(j => scoreColor(j.match_pct) + 'cc'),
        borderRadius: 6,
      }]
    },
    options: {
      ...CHART_DEFAULTS,
      indexAxis: 'y',
      scales: {
        x: { ...CHART_DEFAULTS.scales.x, max: 100 },
        y: { ...CHART_DEFAULTS.scales.y }
      },
      plugins: {
        ...CHART_DEFAULTS.plugins,
        tooltip: { callbacks: { label: ctx => `Match: ${ctx.raw}%` } }
      }
    }
  });

  document.getElementById('jobCards').innerHTML = sorted.slice(0, 5).map(j => {
    const mc    = scoreColor(j.match_pct);
    const reqH  = (j.required_skills||[]).slice(0,5).map(s=>`<span class="pill pill-blue">${s}</span>`).join('');
    const misH  = (j.missing_skills ||[]).slice(0,4).map(s=>`<span class="pill pill-red">${s}</span>`).join('');
    return `
    <div class="job-card">
      <div class="job-header">
        <div class="job-title">${j.title}</div>
        <div class="job-match" style="color:${mc}">${j.match_pct}%</div>
      </div>
      <div class="job-salary">ğŸ’° $${j.avg_salary_usd || 'N/A'}</div>
      <div class="job-section-label">Required Skills</div>
      <div class="pill-row" style="margin-bottom:0.5rem">${reqH}</div>
      ${misH ? `<div class="job-section-label">Missing</div><div class="pill-row">${misH}</div>` : ''}
    </div>`;
  }).join('');
}

// â”€ 5. Salary â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSalary(salary, jobs) {
  document.getElementById('salSummary').textContent   = 'ğŸ’¡ ' + (salary.market_summary || '');
  document.getElementById('salCurrent').textContent   = salary.current_estimated_range || 'N/A';
  document.getElementById('salPotential').textContent = salary.potential_range_with_upskilling || 'N/A';

  // Salary by role chart
  const byRole = salary.by_role || [];
  if (byRole.length) {
    const parseNum = s => parseInt((s||'0').replace(/\D/g,'')) || 0;
    destroyChart('salaryChart');
    const ctx = document.getElementById('salaryChart').getContext('2d');
    charts['salaryChart'] = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: byRole.map(r => r.role),
        datasets: [
          { label: 'Min',  data: byRole.map(r => parseNum(r.min)), backgroundColor: '#4f9eff88', borderRadius: 4 },
          { label: 'Avg',  data: byRole.map(r => parseNum(r.avg)), backgroundColor: '#f5c54288', borderRadius: 4 },
          { label: 'Max',  data: byRole.map(r => parseNum(r.max)), backgroundColor: '#00e5a088', borderRadius: 4 },
        ]
      },
      options: {
        ...CHART_DEFAULTS,
        plugins: { legend: { display: true, labels: { color: '#888', font: { family: 'IBM Plex Mono', size: 11 } } } },
      }
    });

    // Table
    document.getElementById('salBody').innerHTML = byRole.map(r => `
      <tr>
        <td style="font-weight:600">${r.role}</td>
        <td style="color:var(--blue)">${r.min}</td>
        <td style="color:var(--yellow)">${r.avg}</td>
        <td style="color:var(--green)">${r.max}</td>
      </tr>`).join('');
  }
}

// â”€ 6. Learning Path â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderLearning(learning) {
  const priorityColor = p => p === 'high' ? '#00e5a0' : p === 'medium' ? '#f5c542' : '#888';
  document.getElementById('learnGrid').innerHTML = learning.map(item => {
    const pc = priorityColor(item.priority);
    return `
    <div class="learn-card">
      <div class="learn-header">
        <div class="learn-skill" style="color:${pc}">${(item.skill||'').toUpperCase()}</div>
        <span class="learn-badge" style="color:${pc};border-color:${pc}40;background:${pc}20">${(item.priority||'').toUpperCase()}</span>
      </div>
      <div class="learn-resource">ğŸ“š ${item.resource || ''}</div>
      <div class="learn-meta">
        <span>â± ${item.estimated_time || ''}</span>
        <span class="learn-salary">ğŸ’° ${item.salary_impact || ''}</span>
      </div>
    </div>`;
  }).join('');
}
</script>
</body>
</html>